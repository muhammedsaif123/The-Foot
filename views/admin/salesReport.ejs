<%- include('../layouts/header.ejs')%>
<title>Sales Report</title>
	<style>
		table {
			border-collapse: collapse;
			width: 100%;
		}

		th, td {
			padding: 8px;
			text-align: left;
			border-bottom: 1px solid #ddd;
		}

		tr:hover {
			background-color: #f5f5f5;
		}

		th {
			background-color: #000000;
			color: white;
		}

		h1 {
			text-align: center;
		}

		form {
			text-align: center;
			margin-bottom: 30px;
		}

		input[type=date] {
			padding: 8px;
			border: none;
			border-bottom: 1px solid #ddd;
			width: 200px;
			margin-right: 10px;
			margin-left: 10px;
		}

		input[type=submit] {
			background-color: #000000;
			color: white;
			padding: 8px 16px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
		}
	</style>
</head>
<body>
	<h1></h1>
	<form  method="post" >
   
		<label for="start_date">Start Date:</label>
		<input type="date" id="startDate" name="startDate">

		<label for="end_date">End Date:</label>
		<input type="date" name="endDate" >
   
		<input type="submit" value="Generate Report">
    
	</form>
    <br>    
    <section class="md">
        <div class="container">
            <div class="row justify-content-center">
    
                <!-- left panel -->
                
                <!-- end left panel -->
    
                <!-- right panel -->
                <div class="col-lg-12">
    
                    <div class="common-block">               
    
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Date</th>
                                    <th>Address</th>
                                    <th>Payment</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    
                                </tr>
                            </thead>
                          <tbody>
                            
                            <%if(salesReport.length > 0){
    
                                for(let i =0 ;i<salesReport.length;i++){
                                    %>
                                    <tr>
                                        <td><%=salesReport[salesReport.length-i-1].userName%></td>
                                        <td><%=salesReport[salesReport.length-i-1].date.toISOString().substring(0,10)%></td>
                                        <td><%=salesReport[salesReport.length-i-1].deliveryAddress%></td>
                                        <td><%=salesReport[salesReport.length-i-1].paymentMethod%></td>
                                        <td>â‚¹<%=salesReport[salesReport.length-i-1].totalAmount%></td>
                                        <td><%=salesReport[salesReport.length-i-1].status%></td>
                                    </tr>
                                    
                                    <%}
                          }%>
                          </tbody>
                             <tfoot>
			<tr>
				
				
        </td>
				<td><a href="#" onclick="downloadSalesReport()"><button type="button" class="btn btn-dark">Download Reports</button></a>
          
        </td>
			</tr>
		</tfoot>
		
	</table>
                        </table>
                    </div>
                    
                    </div>
    
                </div>
               
            </div>
        </div>
    </section>



    <script>
        function downloadSalesReport() {
         const rows = document.querySelectorAll("table tr");
         const csvContent = "data:text/csv;charset=utf-8,"
           + Array.from(rows)
               .map(row => Array.from(row.cells)
                 .map(cell => cell.textContent.trim())
                 .join(",")
               )
               .join("\n");
         const encodedUri = encodeURI(csvContent);
         const link = document.createElement("a");
         link.setAttribute("href", encodedUri);
         link.setAttribute("download", "sales_report.csv");
         document.body.appendChild(link);
         link.click();
       }
       
       </script>
    