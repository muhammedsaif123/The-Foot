<%- include('../layouts/header.ejs')%>
<br>
<br>
    <!-- Add the following CSS stylesheets -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.css">
 <script src="cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <!-- Add the following JavaScript scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.18/dist/sweetalert2.min.js"></script>
<section class="md">
    <div class="container">
       
    <div class="row justify-content-center">

            <!-- left panel -->
            
            <!-- end left panel -->

            <!-- right panel -->
            <div class="col-lg-12">

                <div class="common-block">               

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Coupon Code</th>
                                <th>Discount Amount</th>
                                <th>Expiry Date</th>
                                <th>Max CartAmount</th>
                                <th>Max discount</th>
                                <th>Limit</th>    
                                <th>Action</th>
                            </tr>
                        </thead>
                      <tbody>
                        <%if(couponData.length > 0){
                            for(let i=0;i<couponData.length;i++){
                                %>
                                <tr>
                                    <td><%=couponData[i].code%></td>
                                    <td>₹<%=couponData[i].discountAmount%></td>
                                    <td><%=couponData[i].expiryDate%></td>
                                    <td>₹<%=couponData[i].maxCartAmount%></td>
                                    <td>₹<%=couponData[i].maxDiscountAmount%></td>
                                    <td><%=couponData[i].maxUsers%></td>
                                    <td>
                                        <a href="/admin/editCoupon?id=<%=couponData[i].id%>">
                                        <div class="pricing mt-1">
                                            <button class="btn btn-success py-2 px-3" style="margin-bottom: 2px;">Edit</button>
                                        </div>
                                    </a>
                                    </td>
                                    <td>
                                        <a href="#">
                                            <div class="pricing mt-1">
                                                <button class="btn btn-danger py-2 px-3" style="margin-bottom: 2px;" onclick="confirmDelete('<%=couponData[i].id%>')">Delete</button>
                                            </div>
                                        </a>
                                    </td>
                                </tr>
                          <%  } 
                        }else{%>
                            <p>Coupon Not Found</p>
                            <%
                        }
                        %> 
                       
                    </tbody>
                </table>
            </div>
            
            </div>

        </div>
       
    </div>
</div>
</section>

<script>
    function confirmDelete(couponId){
        Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
        if (result.isConfirmed){
            console.log(result.isConfirmed);
            $.ajax({
            url:'/admin/deleteCoupon',
            method:'post',
            data:{
               id:couponId
            },
            success:(response)=>{
                if((response.remove = true)){
                    location.reload()
                }
            },
            error: (error) => {
              console.error(error);
            }
          })    
        }
      })
    }
</script>